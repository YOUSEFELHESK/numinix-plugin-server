syntax = 'proto3';

package lexmodo.v1.store_credit;

option go_package = "bitbucket.org/lexmodo/proto/store_credit";

import "google/protobuf/wrappers.proto";

import "google/protobuf/empty.proto";

import "order_modules.proto";

import "orders.proto";

service StoreCredit{

    rpc GetStoreCreditListing(StoreCreditRuleRequest)  returns ( ResultResponse)  {}

	rpc ApplyOrderModule(ApplyOrderModuleRequest) returns (ResultResponse) {}

	rpc ProcessModule(ApplyOrderModuleRequest) returns (ResultResponse) {}
	
    rpc CreateLedgerRule(StoreCreditRuleRequest) returns (ResultResponse) {}

	rpc GetLedgerListing(LedgerListing) returns (ResultResponse) {}

    rpc DeleteLedgerRule(StoreCreditRuleRequest) returns (ResultResponse) {}

    rpc CreateStoreCredit(StoreCreditRequest) returns (ResultResponse) {}

    rpc DeleteStoreCredit(StoreCreditRequest) returns (ResultResponse) {}

    rpc GetStoreCredit(StoreCreditRequest) returns (ResultResponse) {}

    rpc GetCustomerLedger(LedgerRequest) returns (ResultResponse) {}

    rpc GetLedgerRule(google.protobuf.Empty) returns(ResultResponse){}

    rpc UpdateCustomerLedger(LedgerRequest) returns(ResultResponse){}

    rpc RedeemGiftCode(StoreCreditRequest) returns(ResultResponse){}
    
}

enum STORE_CREDIT_STATUS{
    undefined = 0;
    active = 1;
    scheduled =2;
    expired =3;
    claimed =4;

}


    enum AWARD_SETTINGS{

        order_placed = 0;
        order_shipped = 1;
        customer_signup = 2;
        customer_newsletter = 3;
        gift_card = 4;
        custom_amount =5;
    }


    enum LEDGER_TYPE{
        debit =0;
        credit =1;
    }
    
    enum LEDGER_STATUS {

        approved = 0;
        pending = 1;
        denied =2;
    }
 

message ApplyOrderModuleRequest{

    lexmodo.v1.orders.Invoice invoice =1;

    AWARD_SETTINGS award_action =2;

    LedgerRequest ledger =3;

}

message ProductVariant{
    string product_id = 1;
    string variant_id = 2;
}

message apply_type_ids{

    repeated string ids =1;

}

message apply_to_products{

    repeated  ProductVariant apply_to_products = 1;

}

message Performance{

	string customers_id = 1;

	uint32 total_balance_amount = 2;

	uint32 total_pending_amount = 3;

	repeated LedgerRequest ledger =5; 

}	

message TransactionComment{

    uint64 comment_date =1;

    string comment_text =2;

}

message TransactionTag{
    
    string store_credit_id = 1;


    string store_credit_tag =2;

    string gift_card_code =3;
}

message LedgerRequest{

	string ledger_id =1;

	string customer_id = 2;

	TransactionTag transaction_tags = 3;

    
	LEDGER_STATUS transaction_status = 4; //can be updated

	uint64 transaction_date =5;

	string invoice_uuid =6;

    string invoice_id =7;

    repeated  TransactionComment transaction_comment = 8; //can be updated

    google.protobuf.Int32Value transaction_amount =9; // can be updated

    LEDGER_TYPE transaction_type = 10; 

    uint64 last_update = 11;

    bool balances_only = 12; //not to retreive a log of all Ledger 

    
}

message RuleSortBy {

    string column_name =1;
    enum SORT{
        asc =0;
        desc=1;
    }
    SORT sort_order =2;
}

message StoreCreditRuleRequest{

    string rule_id = 1;
    string rule_name = 2;

    string rule_query = 3;
    repeated RuleSortBy sort_by =4;
    bool store_view = 5;
    map<string,string> custom_data = 6;
    uint64 sort_order =7;
    string pit =8;
    uint32 display_result = 9;
} 


message StoreCreditListing{

    uint32 page_num = 1;
    uint32 total_result = 2;
    uint32 display_result = 3;
    repeated StoreCreditRequest store_credit_listing = 4;
    string pit =5;
    
   
}

message LedgerListing{

    string assoicated_rule_id = 1;
    uint32 page_num = 2;
    uint32 total_result = 3;
    uint32 display_result = 4;
    repeated LedgerRequest ledger_listing = 5;
    string rule_id = 6;

    string rule_query = 7;
    repeated RuleSortBy sort_by =8;
    string pit =9;
}

message ResultResponse{

	bool success = 1;
    bool failure = 2;
    string code = 3;
    string message = 4;
    Performance customer_performance = 5;
    StoreCreditRequest store_credit = 6;

    lexmodo.v1.order.modules.OrderTotal applied_store_credit = 7;
    LedgerListing ledger_listing = 8;

    repeated StoreCreditRuleRequest rules = 9;

    StoreCreditRuleRequest rule =10;

    lexmodo.v1.order.modules.OrderTotal applied_order_module =11;
    StoreCreditListing store_credit_listing =12;
    
}


enum APPLY_TYPE{

        specific_categories = 0;
        specific_products = 1;
        specific_products_rule =2;
        specific_action =3;
        specific_customers_rule =4;
        specific_customers =5;
        not_valid = 6;

}

message StoreCreditRequest{

	string store_credit_tag = 1;

    oneof amount{

        google.protobuf.StringValue percentage =2;

        google.protobuf.Int32Value dollar = 3;
    }

    google.protobuf.Int32Value active_date = 4;

    google.protobuf.Int32Value end_date = 5;

    STORE_CREDIT_STATUS store_credit_status = 6;

    APPLY_TYPE apply_type_setting = 7;

    oneof apply_to{

        string apply_to_id = 8;

        apply_to_products apply_to_products = 9;

    }

    AWARD_SETTINGS issue_store_credit =10;

    bool require_approval =11;

    google.protobuf.StringValue gift_card_code = 12;

   	repeated google.protobuf.StringValue customers_id = 13;

    string store_credit_id =14;

    uint64 created_on = 15;
    
    uint64 updated_on = 16;
}
