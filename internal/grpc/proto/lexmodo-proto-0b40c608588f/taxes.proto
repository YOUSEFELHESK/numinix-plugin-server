syntax = 'proto3';

package lexmodo.v1.taxes;

option go_package = "bitbucket.org/lexmodo/proto/taxes";

import "google/protobuf/wrappers.proto";

import "google/protobuf/empty.proto";

import "order_modules.proto";

import "orders.proto";

import "money.proto";

service Taxes{

    rpc GetDefaultTaxRate(CountryTaxDisplay)  returns (ResultResponse)  {}

    rpc ApplyOrderModule(ApplyOrderModuleRequest) returns (ResultResponse) {}

    rpc CreateTax(StoreTaxRequest) returns (ResultResponse) {}

    rpc DeleteTax(StoreTaxRequest) returns (ResultResponse) {}

    rpc ListStoreTax(google.protobuf.Empty) returns (ResultResponse) {}

    rpc GetStoreCountryTax(StoreTaxRequest) returns (ResultResponse) {}
}

    enum TAX_NEXUS{
        invalid = 0;
        origin =1;    
        destination = 2;
        hybrid = 3;

    }
message ApplyOrderModuleRequest{

    lexmodo.v1.orders.Invoice invoice =1;

}

message ResultResponse{

	bool success = 1;
    bool failure = 2;
    string code = 3;
    string message = 4;
   	CountryTaxDisplay country_default_tax = 5;
   	lexmodo.v1.order.modules.OrderTotal applied_order_module =6;

   	repeated StoreTaxSummary store_collecting_countries_tax =7;

    StoreTaxRequest store_collecting_country_tax = 8;

    TaxableProducts taxable_products =9;

}

message DetailedTaxBreakDownDisplay{

    google.protobuf.StringValue county_name = 1;

    google.protobuf.StringValue city_name = 2;

    google.protobuf.StringValue tax_state_rate =3;  

    google.protobuf.StringValue tax_county_rate =4;

    google.protobuf.StringValue tax_city_rate = 5;

    google.protobuf.StringValue tax_special_jurisdiction_rate =6;

    google.protobuf.StringValue zip_code = 7;

    string tax_combined_rate =8;

}

message ProvinceTaxBreakdownDisplay{

    string state_name =1;

    string state_code = 2;

    repeated DetailedTaxBreakDownDisplay state_tax_breakdown = 3;
    
	string comments = 4;

    google.protobuf.StringValue tax_name =5;

    enum SHIPPING_CALCULATIONS{
        default_no =0;
        do_not_tax_shipping =1;
        
        tax_shipping =2;
    };

    SHIPPING_CALCULATIONS shipping_tax_calculations =6;

    google.protobuf.StringValue tax_combined_rate =7;

    google.protobuf.StringValue min_max_tax_combined = 8;

    TAX_NEXUS tax_nexus = 9;

    google.protobuf.BoolValue tax_shipping_editable =10;

    google.protobuf.BoolValue tax_type_editable =11;
}

message CountryTaxDisplay{

	string country_name =1;
	repeated ProvinceTaxBreakdownDisplay states_taxes =2;
    google.protobuf.StringValue country_tax_percentage =3;
    google.protobuf.StringValue tax_name = 4;
    string country_code =5;
}

message ProductVariant{

    string product_id = 1;

    string variant_id = 2;
}

message apply_type_ids{

    repeated string ids =1;

}

message TaxableProducts{

    map<string,bool> taxable_products = 1;
}

message apply_to_products{

    repeated  ProductVariant apply_to_products = 1;



}

enum APPLY_TYPE{

        specific_default =0;
        specific_categories = 1;
        specific_products = 2;
        specific_products_rule =3;
        specific_customers = 4;
        specific_customers_rule = 5;


}

enum TAX_CALCULATION_METHOD{
	
	ADDED =0;
	
	INSTEAD =1;

	COMPOUNDED =2;

}

message DetailedTaxRuleRequest{


	google.protobuf.StringValue zone_name = 1; //This will use thTe basic calculations

    APPLY_TYPE apply_tax_setting = 2;

    oneof apply_to{

        string apply_to_id = 3;

        apply_to_products apply_to_products = 4;

    }


    google.protobuf.StringValue tax_percentage =5;


    money.Money tax_dollar_after = 6;


    bool tax_shipping = 7;

    google.protobuf.StringValue sales_tax_id = 8;

    TAX_CALCULATION_METHOD tax_calculation_method_include_tax_country = 9;


    bool tax_status =10;

    google.protobuf.StringValue zone_code = 11;

    TAX_NEXUS sale_tax_type = 12;

    google.protobuf.StringValue province_zone_tax_name =13;


   ///  uint64 updated_on = 16;
}


message StoreTaxSummary{

	string country_code =1;

	string country_name =2;
	enum SETUP{
    	not_setup =0;
    	partial_setup =1;
    	full_setup =2;
    }

    SETUP setup_status =3;

    uint32 number_of_regions =4;

    uint64 created_on = 5;
}

message CountryTaxRuleRequest{

    string country_name =1;

	string country_code =2;

	repeated DetailedTaxRuleRequest tax_province =3;

    google.protobuf.StringValue country_tax_percentage =4;


    google.protobuf.StringValue country_zone_tax_name =5;


    bool country_tax_shipping = 6;

    bool country_tax_status =7;
}

message WorldWideRuleRequest {

    repeated DetailedTaxRuleRequest world_wide_rules= 1;
}

message StoreTaxRequest{

    oneof tax_location{


        CountryTaxRuleRequest country = 1;

        WorldWideRuleRequest world_wide =2; 
    }

    uint64 created_on = 3;
    
    uint64 updated_on = 4;

    google.protobuf.StringValue tax_name =5;

}